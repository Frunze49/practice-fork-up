# protobuf-zhukov-afanasyeva

Фазила решение примерно 1 час. В первоначальном коммите ветки сохранена версия решения автора, а в последнем коммите - исправленная версия после фаззинга

## Запуск фаззера
```sh
rustup default nightly
cargo install cargo-fuzz
cargo fuzz run fuzz_target_1
```

## Найденные и решенные проблемы
- код конвертирующих функций перенесён в src/lib.rs, чтобы можно было их звать из fuzz/fuzz_targets
- Была проблема с логикой конвертации из bin в протобуф Students. Автор решения добавлял студентов, которых смог распасить, и шел по файлу до момента, как сталкивался с первой ошибкой, далее отдавал из функции в качестве результата тех студентов, которых смог попарсить. Из-за этого нарушается round-trip guarantee: существуют ситуации с невалидным вводом, когда программа не возвращает ошибку, а успешно доходит до конца, в результате чего итог не совпадает побитно с начальным бинарным файлом. Проблему решила, переписав логику функции read_students_from_bin_file: теперь она заходит в функцию read_student_from_bin_file только, если в вводе ещё есть байты, а также всегда возвращает ошибку при ошибках парсинга студента.
- Также была проблема с тем, что функция read_student_from_bin_file возвращала ошибку только при ошибках ввода (std::io::Error), а при других ошибках (невозможности конвертировать в utf8) паниковала, в результате чего падала программа. Починила, убрав вызов unwrap() на возвращение ошибки через '?'
